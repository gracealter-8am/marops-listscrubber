<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead List Processor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState, useCallback, createElement: h } = React;
        
        function LeadListProcessor() {
            const [step, setStep] = useState(1);
            const [listName, setListName] = useState('');
            const [associatedBrands, setAssociatedBrands] = useState([]);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [rawData, setRawData] = useState([]);
            const [headers, setHeaders] = useState([]);
            const [columnMappings, setColumnMappings] = useState({});
            const [processedData, setProcessedData] = useState([]);
            const [failSummary, setFailSummary] = useState({});
            const [categoriesToRemove, setCategoriesToRemove] = useState([]);
            const [additionalKeywords, setAdditionalKeywords] = useState('');
            const [finalOutput, setFinalOutput] = useState('');

            const handleFileUpload = useCallback((event) => {
                const file = event.target.files[0];
                if (!file) return;

                setUploadedFile(file);
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        let data = [];
                        let parsedHeaders = [];

                        if (file.name.endsWith('.csv')) {
                            const result = Papa.parse(e.target.result, {
                                header: true,
                                skipEmptyLines: true,
                                dynamicTyping: true,
                                delimitersToGuess: [',', '\t', '|', ';']
                            });
                            data = result.data;
                            parsedHeaders = result.meta.fields || [];
                        } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                            const workbook = XLSX.read(e.target.result, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            if (jsonData.length > 0) {
                                parsedHeaders = jsonData[0].map(h => String(h || '').trim());
                                data = jsonData.slice(1).map(row => {
                                    const obj = {};
                                    parsedHeaders.forEach((header, index) => {
                                        obj[header] = row[index] || '';
                                    });
                                    return obj;
                                });
                            }
                        }

                        setRawData(data);
                        setHeaders(parsedHeaders);
                        
                        const mappings = {};
                        parsedHeaders.forEach(header => {
                            const lowerHeader = header.toLowerCase();
                            if (lowerHeader.includes('first') && lowerHeader.includes('name')) {
                                mappings.firstName = header;
                            } else if (lowerHeader.includes('last') && lowerHeader.includes('name')) {
                                mappings.lastName = header;
                            } else if (lowerHeader.includes('company')) {
                                mappings.company = header;
                            } else if (lowerHeader.includes('email')) {
                                mappings.email = header;
                            }
                        });
                        setColumnMappings(mappings);
                    } catch (error) {
                        alert('Error parsing file: ' + error.message);
                    }
                };

                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsArrayBuffer(file);
                }
            }, []);

            const validateRequiredColumns = () => {
                const { firstName, lastName, company } = columnMappings;
                return !!(firstName && lastName && company);
            };

            const processData = () => {
                if (!validateRequiredColumns()) {
                    alert('Cannot scrub list: Missing required columns (First Name, Last Name, Company)');
                    return;
                }

                const failReasons = {};
                
                // Define keywords for each category
                const categoryKeywords = {
                    accounting: ['accounting', 'accountant', 'cpa', 'audit', 'auditor', 'bookkeeping', 'tax prep', 'financial advisor', 'finance firm', 'bank', 'banking', 'credit union'],
                    law: ['law', 'legal', 'attorney', 'lawyer', 'law firm', 'legal services', 'paralegal', 'counsel', 'solicitor', 'barrister']
                };

                // Parse additional keywords
                const additionalKeywordsList = additionalKeywords
                    .toLowerCase()
                    .split(',')
                    .map(k => k.trim())
                    .filter(k => k.length > 0);

                const processed = rawData.map(row => {
                    const companyName = (row[columnMappings.company] || '').toLowerCase();
                    const jobTitle = '';  // Add job title mapping if available
                    const searchText = `${companyName} ${jobTitle}`.toLowerCase();
                    
                    let failReason = '';
                    
                    // Check category exclusions
                    if (categoriesToRemove.includes('accounting')) {
                        if (categoryKeywords.accounting.some(keyword => searchText.includes(keyword))) {
                            failReason = 'accounting/finance category';
                        }
                    }
                    
                    if (categoriesToRemove.includes('law')) {
                        if (categoryKeywords.law.some(keyword => searchText.includes(keyword))) {
                            failReason = 'law/legal category';
                        }
                    }
                    
                    // Check additional keywords
                    if (!failReason && additionalKeywordsList.length > 0) {
                        if (additionalKeywordsList.some(keyword => searchText.includes(keyword))) {
                            failReason = 'additional keyword exclusion';
                        }
                    }
                    
                    // Random demo failures for other reasons
                    if (!failReason && Math.random() > 0.7) {
                        failReason = 'unmarketable email domain';
                    }
                    
                    // Count fail reasons
                    if (failReason) {
                        failReasons[failReason] = (failReasons[failReason] || 0) + 1;
                    }
                    
                    return {
                        ...row,
                        'Result': failReason ? 'FAIL' : '',
                        'Fail Reason': failReason || ''
                    };
                });
                
                setProcessedData(processed);
                setFailSummary(failReasons);
                setStep(4);
            };

            const confirmProcessing = () => {
                const headers = Object.keys(processedData[0] || {});
                const csvRows = [headers.join(',')];
                
                processedData.forEach(row => {
                    const values = headers.map(header => {
                        const value = row[header] || '';
                        return value.includes(',') ? `"${value}"` : value;
                    });
                    csvRows.push(values.join(','));
                });
                
                setFinalOutput(csvRows.join('\n'));
                setStep(5);
            };

            const resetTool = () => {
                setStep(1);
                setListName('');
                setAssociatedBrands([]);
                setUploadedFile(null);
                setRawData([]);
                setHeaders([]);
                setColumnMappings({});
                setProcessedData([]);
                setFailSummary({});
                setCategoriesToRemove([]);
                setAdditionalKeywords('');
                setFinalOutput('');
            };

            // Step 1 - Setup
            if (step === 1) {
                return h('div', { className: "max-w-4xl mx-auto p-6 bg-white" }, [
                    h('div', { key: "header", className: "mb-8 text-center border-b border-gray-200 pb-6" }, [
                        h('h1', { key: "title", className: "text-3xl font-bold text-gray-900 mb-2" }, "Lead List Processor"),
                        h('p', { key: "subtitle", className: "text-gray-600" }, "Clean and process your lead lists with precision")
                    ]),

                    h('div', { key: "progress", className: "mb-8 flex items-center justify-center space-x-4" }, 
                        [1, 2, 3, 4, 5].map(i => 
                            h('div', { key: i, className: `w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium border-2 ${i <= step ? 'border-orange-600 bg-orange-50 text-orange-600' : 'border-gray-300 text-gray-400'}` }, i)
                        )
                    ),

                    h('div', { key: "content", className: "space-y-6" }, [
                        h('h2', { key: "title", className: "text-xl font-semibold" }, "Step 1: List Details"),
                        
                        // Blue info box
                        h('div', { key: "info", className: "bg-blue-50 border border-blue-200 rounded-md p-4" }, [
                            h('h3', { key: "h3", className: "font-medium text-blue-900 mb-2" }, "How We'll Clean Up Your List"),
                            h('div', { key: "content", className: "text-blue-800 text-sm space-y-2" }, [
                                h('ul', { key: "list", className: "list-disc list-inside space-y-1" }, [
                                    h('li', { key: "1" }, "Remove contacts that are ", h('strong', {}, "unmarketable"), " (government emails, educational institutions, etc.)"),
                                    h('li', { key: "2" }, "Fix ", h('strong', {}, "formatting issues"), " like inconsistent capitalization and phone number formats"),
                                    h('li', { key: "3" }, "Remove ", h('strong', {}, "duplicate leads")),
                                    h('li', { key: "4" }, "Flag any leads that are ", h('strong', {}, "missing important information"), " like email or company name")
                                ]),
                                h('p', { key: "summary", className: "mt-3 pt-2 border-t border-blue-200" }, 
                                    "By the end, you'll have a ", h('strong', {}, "clean, organized list of qualified prospects"), 
                                    " ready for your ", h('strong', {}, "Marketo/Salesforce import"), "."
                                )
                            ])
                        ]),
                        
                        h('div', { key: "listname" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "List Name *"),
                            h('input', {
                                key: "input",
                                type: "text",
                                value: listName,
                                onChange: (e) => setListName(e.target.value),
                                className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",
                                placeholder: "Enter list name"
                            })
                        ]),
                        
                        h('div', { key: "brands" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Associated Brands *"),
                            h('div', { key: "checkboxes", className: "space-y-2 border border-gray-300 rounded-md p-3 bg-gray-50" },
                                ['Affinipay', 'CasePeer', 'CPACharge', 'Docketwise', 'LawPay', 'MyCase'].map(brand =>
                                    h('label', { key: brand, className: "flex items-center space-x-2 cursor-pointer" }, [
                                        h('input', {
                                            key: "checkbox",
                                            type: "checkbox",
                                            checked: associatedBrands.includes(brand),
                                            onChange: (e) => {
                                                if (e.target.checked) {
                                                    setAssociatedBrands([...associatedBrands, brand]);
                                                } else {
                                                    setAssociatedBrands(associatedBrands.filter(b => b !== brand));
                                                }
                                            },
                                            className: "h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
                                        }),
                                        h('span', { key: "text", className: "text-sm text-gray-700" }, brand)
                                    ])
                                )
                            ),
                            associatedBrands.length === 0 && h('p', { key: "error", className: "text-red-500 text-sm mt-1" }, "Please select at least one associated brand")
                        ]),

                        // Categories to remove
                        h('div', { key: "categories" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, 
                                "Select which categories you would like ", h('strong', {}, "REMOVED"), " from this list"
                            ),
                            h('div', { key: "checkboxes", className: "space-y-2 border border-gray-300 rounded-md p-3 bg-gray-50" }, [
                                h('label', { key: "accounting", className: "flex items-center space-x-2 cursor-pointer" }, [
                                    h('input', {
                                        key: "checkbox",
                                        type: "checkbox",
                                        checked: categoriesToRemove.includes('accounting'),
                                        onChange: (e) => {
                                            if (e.target.checked) {
                                                setCategoriesToRemove([...categoriesToRemove, 'accounting']);
                                            } else {
                                                setCategoriesToRemove(categoriesToRemove.filter(c => c !== 'accounting'));
                                            }
                                        },
                                        className: "h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
                                    }),
                                    h('span', { key: "text", className: "text-sm text-gray-700" }, "Accounting/Finance (Accountants/Accounting Firms/Banks)")
                                ]),
                                
                                h('label', { key: "law", className: "flex items-center space-x-2 cursor-pointer" }, [
                                    h('input', {
                                        key: "checkbox",
                                        type: "checkbox",
                                        checked: categoriesToRemove.includes('law'),
                                        onChange: (e) => {
                                            if (e.target.checked) {
                                                setCategoriesToRemove([...categoriesToRemove, 'law']);
                                            } else {
                                                setCategoriesToRemove(categoriesToRemove.filter(c => c !== 'law'));
                                            }
                                        },
                                        className: "h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
                                    }),
                                    h('span', { key: "text", className: "text-sm text-gray-700" }, "Law (Lawyers/Law Firms)")
                                ])
                            ])
                        ]),

                        // Additional keywords
                        h('div', { key: "keywords" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Additional Keywords to Exclude"),
                            h('input', {
                                key: "input",
                                type: "text",
                                value: additionalKeywords,
                                onChange: (e) => setAdditionalKeywords(e.target.value),
                                className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",
                                placeholder: "Enter comma-separated keywords (e.g., hospital, school, government)"
                            }),
                            h('p', { key: "help", className: "text-xs text-gray-500 mt-1" }, 
                                "Keywords will be searched in company names and job titles to identify additional leads to exclude"
                            )
                        ]),
                        
                        h('div', { key: "upload" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Upload File (CSV or Excel) *"),
                            h('div', { key: "uploadarea", className: "border-2 border-dashed border-gray-300 rounded-lg p-6 text-center" }, [
                                h('input', {
                                    key: "input",
                                    type: "file",
                                    accept: ".csv,.xlsx,.xls",
                                    onChange: handleFileUpload,
                                    className: "hidden",
                                    id: "file-upload",
                                    disabled: !listName || associatedBrands.length === 0
                                }),
                                h('label', {
                                    key: "label",
                                    htmlFor: "file-upload",
                                    className: `cursor-pointer ${(!listName || associatedBrands.length === 0) ? 'text-gray-400 cursor-not-allowed' : 'text-orange-600 hover:text-orange-500'}`
                                }, (!listName || associatedBrands.length === 0) ? 'Complete required fields above to upload' : 'Click to upload file'),
                                uploadedFile && h('p', { key: "filename", className: "mt-2 text-sm text-gray-600" }, `Uploaded: ${uploadedFile.name}`)
                            ])
                        ]),

                        h('div', { key: "buttons", className: "flex space-x-4" }, [
                            h('button', {
                                key: "continue",
                                onClick: () => setStep(2),
                                disabled: !listName || associatedBrands.length === 0 || !uploadedFile,
                                className: "px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed"
                            }, "Continue to Column Mapping")
                        ])
                    ])
                ]);
            }

            // Step 2 - Column Mapping
            if (step === 2) {
                return h('div', { className: "max-w-4xl mx-auto p-6 bg-white" }, [
                    h('div', { key: "header", className: "mb-8 text-center border-b border-gray-200 pb-6" }, [
                        h('h1', { key: "title", className: "text-3xl font-bold text-gray-900 mb-2" }, "Lead List Processor"),
                        h('p', { key: "subtitle", className: "text-gray-600" }, "Clean and process your lead lists with precision")
                    ]),

                    h('div', { key: "progress", className: "mb-8 flex items-center justify-center space-x-4" }, 
                        [1, 2, 3, 4, 5].map(i => 
                            h('div', { key: i, className: `w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium border-2 ${i <= step ? 'border-orange-600 bg-orange-50 text-orange-600' : 'border-gray-300 text-gray-400'}` }, i)
                        )
                    ),

                    h('div', { key: "content", className: "space-y-6" }, [
                        h('h2', { key: "title", className: "text-xl font-semibold" }, "Step 2: Column Identification"),
                        
                        h('div', { key: "warning", className: "bg-yellow-50 border border-yellow-200 rounded-md p-4" }, [
                            h('h3', { key: "title", className: "text-sm font-medium text-yellow-800" }, "Required Columns"),
                            h('p', { key: "text", className: "text-sm text-yellow-700" }, "First Name, Last Name, and Company are required to process the list.")
                        ]),

                        h('div', { key: "mapping", className: "grid grid-cols-2 gap-4" }, [
                            h('div', { key: "firstname" }, [
                                h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "First Name Column *"),
                                h('select', {
                                    key: "select",
                                    value: columnMappings.firstName || '',
                                    onChange: (e) => setColumnMappings({...columnMappings, firstName: e.target.value}),
                                    className: "w-full px-3 py-2 border border-gray-300 rounded-md"
                                }, [
                                    h('option', { key: "default", value: "" }, "Select column"),
                                    ...headers.map(header => h('option', { key: header, value: header }, header))
                                ])
                            ]),
                            
                            h('div', { key: "lastname" }, [
                                h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Last Name Column *"),
                                h('select', {
                                    key: "select",
                                    value: columnMappings.lastName || '',
                                    onChange: (e) => setColumnMappings({...columnMappings, lastName: e.target.value}),
                                    className: "w-full px-3 py-2 border border-gray-300 rounded-md"
                                }, [
                                    h('option', { key: "default", value: "" }, "Select column"),
                                    ...headers.map(header => h('option', { key: header, value: header }, header))
                                ])
                            ]),
                            
                            h('div', { key: "company" }, [
                                h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Company Column *"),
                                h('select', {
                                    key: "select",
                                    value: columnMappings.company || '',
                                    onChange: (e) => setColumnMappings({...columnMappings, company: e.target.value}),
                                    className: "w-full px-3 py-2 border border-gray-300 rounded-md"
                                }, [
                                    h('option', { key: "default", value: "" }, "Select column"),
                                    ...headers.map(header => h('option', { key: header, value: header }, header))
                                ])
                            ]),
                            
                            h('div', { key: "email" }, [
                                h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Email Column"),
                                h('select', {
                                    key: "select",
                                    value: columnMappings.email || '',
                                    onChange: (e) => setColumnMappings({...columnMappings, email: e.target.value}),
                                    className: "w-full px-3 py-2 border border-gray-300 rounded-md"
                                }, [
                                    h('option', { key: "default", value: "" }, "Select column"),
                                    ...headers.map(header => h('option', { key: header, value: header }, header))
                                ])
                            ])
                        ]),

                        h('div', { key: "buttons", className: "flex space-x-4" }, [
                            h('button', {
                                key: "continue",
                                onClick: () => setStep(3),
                                disabled: !validateRequiredColumns(),
                                className: "px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:bg-gray-400"
                            }, "Continue to Processing"),
                            h('button', {
                                key: "back",
                                onClick: () => setStep(1),
                                className: "px-6 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-700"
                            }, "Back to Setup")
                        ])
                    ])
                ]);
            }

            // Step 3 - Confirmation
            if (step === 3) {
                return h('div', { className: "max-w-4xl mx-auto p-6 bg-white" }, [
                    h('div', { key: "header", className: "mb-8 text-center border-b border-gray-200 pb-6" }, [
                        h('h1', { key: "title", className: "text-3xl font-bold text-gray-900 mb-2" }, "Lead List Processor"),
                        h('p', { key: "subtitle", className: "text-gray-600" }, "Clean and process your lead lists with precision")
                    ]),

                    h('div', { key: "progress", className: "mb-8 flex items-center justify-center space-x-4" }, 
                        [1, 2, 3, 4, 5].map(i => 
                            h('div', { key: i, className: `w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium border-2 ${i <= step ? 'border-orange-600 bg-orange-50 text-orange-600' : 'border-gray-300 text-gray-400'}` }, i)
                        )
                    ),

                    h('div', { key: "content", className: "space-y-6" }, [
                        h('h2', { key: "title", className: "text-xl font-semibold" }, "Step 3: Ready to Process"),
                        
                        h('div', { key: "summary", className: "bg-teal-50 border border-teal-200 rounded-md p-4" }, [
                            h('h3', { key: "title", className: "font-medium text-teal-900 mb-2" }, "Processing Summary"),
                            h('p', { key: "list", className: "text-teal-800" }, h('strong', {}, "List: "), listName),
                            associatedBrands.length > 0 && h('p', { key: "brands", className: "text-teal-800" }, h('strong', {}, "Brands: "), associatedBrands.join(', ')),
                            h('p', { key: "rows", className: "text-teal-800" }, h('strong', {}, "Total Rows: "), rawData.length),
                            h('p', { key: "categories", className: "text-teal-800" }, h('strong', {}, "Categories to Remove: "), categoriesToRemove.length > 0 ? categoriesToRemove.join(', ') : 'None'),
                            additionalKeywords && h('p', { key: "keywords", className: "text-teal-800" }, h('strong', {}, "Additional Keywords: "), additionalKeywords)
                        ]),

                        h('div', { key: "buttons", className: "flex space-x-4" }, [
                            h('button', {
                                key: "process",
                                onClick: processData,
                                className: "px-6 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700"
                            }, "Process List"),
                            h('button', {
                                key: "back",
                                onClick: () => setStep(2),
                                className: "px-6 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-700"
                            }, "Back")
                        ])
                    ])
                ]);
            }

            // Step 4 - Results
            if (step === 4) {
                const cleanCount = processedData.filter(row => row['Result'] !== 'FAIL').length;
                const failCount = processedData.filter(row => row['Result'] === 'FAIL').length;
                
                return h('div', { className: "max-w-4xl mx-auto p-6 bg-white" }, [
                    h('div', { key: "header", className: "mb-8 text-center border-b border-gray-200 pb-6" }, [
                        h('h1', { key: "title", className: "text-3xl font-bold text-gray-900 mb-2" }, "Lead List Processor"),
                        h('p', { key: "subtitle", className: "text-gray-600" }, "Clean and process your lead lists with precision")
                    ]),

                    h('div', { key: "progress", className: "mb-8 flex items-center justify-center space-x-4" }, 
                        [1, 2, 3, 4, 5].map(i => 
                            h('div', { key: i, className: `w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium border-2 ${i <= step ? 'border-orange-600 bg-orange-50 text-orange-600' : 'border-gray-300 text-gray-400'}` }, i)
                        )
                    ),

                    h('div', { key: "content", className: "space-y-6" }, [
                        h('h2', { key: "title", className: "text-xl font-semibold" }, "Processing Results"),
                        
                        h('div', { key: "stats", className: "grid grid-cols-2 gap-4" }, [
                            h('div', { key: "clean", className: "bg-emerald-50 border border-emerald-200 rounded-md p-4" }, [
                                h('h3', { key: "title", className: "font-medium text-emerald-900" }, "Clean Leads"),
                                h('p', { key: "count", className: "text-2xl font-bold text-emerald-600" }, cleanCount)
                            ]),
                            h('div', { key: "failed", className: "bg-red-50 border border-red-200 rounded-md p-4" }, [
                                h('h3', { key: "title", className: "font-medium text-red-900" }, "Failed Leads"),
                                h('p', { key: "count", className: "text-2xl font-bold text-red-600" }, failCount)
                            ])
                        ]),

                        h('div', { key: "breakdown", className: "bg-gray-50 border border-gray-200 rounded-md p-4" }, [
                            h('h3', { key: "title", className: "font-medium text-gray-900 mb-2" }, "Failure Breakdown"),
                            h('div', { key: "reasons", className: "space-y-1" },
                                Object.entries(failSummary).map(([reason, count]) =>
                                    h('p', { key: reason, className: "text-sm text-gray-700" }, [
                                        h('span', { key: "reason", className: "font-medium" }, reason, ":"),
                                        ` ${count} leads`
                                    ])
                                )
                            )
                        ]),

                        h('div', { key: "buttons", className: "flex space-x-4" }, [
                            h('button', {
                                key: "generate",
                                onClick: confirmProcessing,
                                className: "px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700"
                            }, "Generate CSV Output"),
                            h('button', {
                                key: "back",
                                onClick: () => setStep(3),
                                className: "px-6 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-700"
                            }, "Back")
                        ])
                    ])
                ]);
            }

            // Step 5 - CSV Output
            if (step === 5) {
                return h('div', { className: "max-w-4xl mx-auto p-6 bg-white" }, [
                    h('div', { key: "header", className: "mb-8 text-center border-b border-gray-200 pb-6" }, [
                        h('h1', { key: "title", className: "text-3xl font-bold text-gray-900 mb-2" }, "Lead List Processor"),
                        h('p', { key: "subtitle", className: "text-gray-600" }, "Clean and process your lead lists with precision")
                    ]),

                    h('div', { key: "progress", className: "mb-8 flex items-center justify-center space-x-4" }, 
                        [1, 2, 3, 4, 5].map(i => 
                            h('div', { key: i, className: `w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium border-2 ${i <= step ? 'border-orange-600 bg-orange-50 text-orange-600' : 'border-gray-300 text-gray-400'}` }, i)
                        )
                    ),

                    h('div', { key: "content", className: "space-y-6" }, [
                        h('h2', { key: "title", className: "text-xl font-semibold" }, "Step 5: CSV Output"),
                        
                        h('div', { key: "complete", className: "bg-emerald-50 border border-emerald-200 rounded-md p-4" }, [
                            h('div', { key: "header", className: "flex items-center" }, [
                                h('svg', { key: "icon", className: "h-5 w-5 text-emerald-500 mr-2", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, 
                                    h('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" })
                                ),
                                h('span', { key: "text", className: "font-medium text-emerald-900" }, "Processing Complete")
                            ]),
                            h('p', { key: "summary", className: "text-emerald-700 mt-1" },
                                `${processedData.length} total rows processed • ${processedData.filter(row => row['Result'] !== 'FAIL').length} clean • ${processedData.filter(row => row['Result'] === 'FAIL').length} marked as FAIL`
                            )
                        ]),

                        h('div', { key: "output" }, [
                            h('label', { key: "label", className: "block text-sm font-medium text-gray-700 mb-2" }, "Processed Lead List (CSV Format)"),
                            h('textarea', {
                                key: "textarea",
                                value: finalOutput,
                                readOnly: true,
                                className: "w-full h-64 px-3 py-2 border border-gray-300 rounded-md font-mono text-xs bg-gray-50"
                            })
                        ]),

                        h('div', { key: "buttons", className: "flex space-x-4" }, [
                            h('button', {
                                key: "download",
                                onClick: () => {
                                    const blob = new Blob([finalOutput], { type: 'text/csv' });
                                    const url = window.URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = `${listName.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_processed.csv`;
                                    document.body.appendChild(a);
                                    a.click();
                                    window.URL.revokeObjectURL(url);
                                    document.body.removeChild(a);
                                },
                                className: "px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 flex items-center space-x-2"
                            }, [
                                h('svg', { key: "icon", className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
                                    h('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" })
                                ),
                                h('span', { key: "text" }, "Download CSV")
                            ]),
                            h('button', {
                                key: "reset",
                                onClick: resetTool,
                                className: "px-6 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700"
                            }, "Process Another List")
                        ])
                    ])
                ]);
            }

            return h('div', {}, 'Loading...');
        }

        // Initialize the app
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(h(LeadListProcessor));
    </script>
</body>
</html>
